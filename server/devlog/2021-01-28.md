# 2021 01 28
* 프로젝트 권한 수정 API 작성
* clip 생성 
* clip 읽어오기
* clip 삭제
* clip 수정

## Clip 생성

처음 클립에 대해서 모호한 점이 있어 팀원과 상의해주었다. 
```
1. 공유클립의 저자는 보이지 않는다
2. 공유클립의 수정, 삭제는 모두가 가능하다
3. 공유클립의 순서또한 모두가 수정가능하다. 단 A가 변경한 경우 B의 화면에도 변경한 내용이 반영된다. 
```

클립은 팀원과 공유되는 클립, 개인 클립으로 나눠진다. 처음에는 user와 관계가 있으면 개인클립, 그렇지 않으면 공유 클립이라고 생각했다. 하지만 공유된 클립을 가져올 때 프로젝트 id만으로 가져오면 공유되지 않은 모든 클립이 가져와질 것 같다는 생각이 들었다. 조건에 user_id가 null인 것만 가져와라 라고 한다면 공용 클립을 가져올 수 있는지 확인하고 안된다면 isprivate column을 추가해 쿼리하는데 편리성을 더해줄 생각이다.

현재까지 생성된 클립의 갯수를 받아오는 메소드에서 `findAndCount`를 사용해주었고, 공유된 클립은 `user_id:null`을 사용해주었다. 정상적으로 작동될지 잘 모르겠다.

NaN에러가 발생했다. 아마 클립의 갯수를 받아오는 부분에서 문제가 있는것 같다 (처음 생성하는 부분이라서) 콘솔로 확인해보니 NaN이 나온다.

undefined의 경우 0이 나올수 있도록 수정해줘야한다. 

수정해주었지만 이제는 계속 0이 나온다. `findAndCount`가 문제인줄 알았자민 아니었다.
`await this.repository.findAndCount({user_id: user, project_id:proj})[1]` 이 부분이 문제였다. 
수정해주었더니 정상적으로 작동한다.

## Clip read

클립의 리스트를 받아오는 API를 작성 도중에 에러를 만나게 되었다. get 요청을 사용하여 query param을 사용하는데 이를 받아 사용하는 과정에서 
`Argument of type 'string | ParsedQs | string[] | ParsedQs[]' is not assignable to parameter of type 'string'.
  Type 'ParsedQs' is not assignable to type 'string'.` 이런 에러를 마주하게 되었다.

`String`을 사용하여 형변환을 해주었고 에러를 해결하였다. 

get요청을 통해 받아왔을 때 개인의 클립을 받아오지 못했다. 조건을 잘못 설정해서 발생하는 문제였다. 

이번에는 개인 클립만 받아왔다. get요청으로 query param에 따라서 나오는 값을 변경하는 것 보다 일단 API를 더 나누기로 했다. 이유는 코드가 중복되더라도 조금 안정적으로 가는게 좋을 것 같았다. 

작성하고 보니 코드 중복이 너무 심했다.. 일단 이렇게 진행하고 다음 리펙토링때 수정할 예정이다.

## Clip edit

클립을 수정하는 API다.

클립을 읽어올 때 해당 클립의 프로젝트와 유저까지 읽어올 줄 알았지만 그렇지 않았다. 쿼리빌더를 사용해 읽어올 예정이다.
## Clip delete

이제부터 난관이다. 인덱싱에 관한 부분이 여기부터 진행된다. 기존에 생성될때는 `생성된 갯수 +1`을 붙여주면 됬었다. 

만약 100개의 클립중 49번째의 클립이 삭제된다면 50~100번까지의 클립 index를 1씩 감소시켜줘야한다. 이에 관련된 레퍼런스가 분명히 있을거라고 생각한다. 하지만 지금은 프로젝트에 대한 시갼이 많이 없으므로 일단 내가 만들려고 한다. 효율적이든 비효율적이든 일단 구현해보고 판단하기로 했다.