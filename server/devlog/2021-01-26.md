# 202 01 26
* 프로젝트 권한 관련 API 작성
* git conflict 해결
* 프로젝트 멤버 확인 API 작성

## 프로젝트 권한

먼저 친구 초대를 어떻게 구현할지 많은 고민이 있었다. 다른 서비스들을 보면 구글 메일로 초대 메일이 가게 되고 그 메일 안에 있는 버튼(링크)를 통해 들어오는 순간 로그인, 프로젝트에 접근이 가능해진다. 이런 기능을 처음에는 어떻게 구현할지 감이 오질 않았다. 그래서 몇가지 리서치를 해봤지만 나오지 않았다. 일단 서버단에서는 API를 만들어주고, 프론트앤드측과 같이 고민하려 한다. 

데이터베이스에 등록된 유저를 찾아야하는데 어떻게 찾을지 고민중이다. 이메일을 통해서 유저를 초대하려면 데이터베이스에 이메일을 추가해줘야한다는 것을 알고 수정해주었다. 

이메일로 유저를 찾는 메소드에서 계속 에러가 발생하는데도 불구하고 초대에 성공했다는 메세지가 계속 온다. (이러면 안되는데) 에러핸들링의 중요성을 여기서 다시 한번 느꼈다.

근데 여기서 왜 유저를 찾지 못하는지 찾지 못했다. 유저의 이메일을 통해서 찾는 메소드를 선언해주었는데 에러도 아니고 undefined만 반환한다.. 

확인해보니 작성한 코드의 저장을 하지 않아 발생하는 문제였다.. 지금은 정상적으로 작동한다.

## git conflict

클라이언트쪽에서 git conflict가 발생했었고 pr을 날리니 문제가 발생했다.github상에서는 해결이 되었지만 내 로컬에서는 문제가 발생했다. 파일을 밀고 다시 받아 진행하고 싶었지만 .env, docker-compose.yml같은 설정 파일들이 있어 바로 하기가 꺼림칙했다. 
```
git fetch --all
git reset --hard origin/dev
```
이렇게 하니 origin에 있던 코드를 강제로 덮어 쓸 수 있었다. 

## 프로젝트 멤버 확인 API
이제까지 작성해준 내용을 토대로 프로젝트 멤버 확인 API는 쉽게 만들어주었다. 

하지만 반환하는 값이 
```
[
    {
        "id": 23,
        "isAdmin": true
    },
    {
        "id": 24,
        "isAdmin": false
    },
    {
        "id": 25,
        "isAdmin": false
    }
]
```
이렇게 보여지고 있어 어떤 유저인지는 제대로 보이고 있지 않는다. 이 또한 쿼리빌더로 join을 해줄 예정이다.

쿼리빌더로 수정해주었다. 하지만 여기서 모든 유저의 social_id등 불려오면 안되는 정보까지 불려와서 수정이 필요하다.

`.select`를 사용하면 될 것 같았지만 되지 않았다. 에러라도 나왔으면 좋겠는데 빈 배열만 나왔다.

해결하는데 생각보다 많은 시간이 걸렸다. 
```
return this.repository.createQueryBuilder('pp')
				.leftJoinAndSelect("pp.user_id", 'u')
				.select(['pp.isAdmin', 'u.uuid', 'u.username', 'u.email'])
				.where("pp.user_id = u.id")
				.andWhere('pp.project_id = :proj_id', {proj_id: project.id})
				.getMany();

```
위 처럼 해주었고, select의 위치와 내부에 들어가는 겂의 문제로 되지 않았었던 것으로 확인되었다.