# 2021 01 11

* 타입 ORM 살펴보기 (datamapper 패턴 숙지, Repository)
* 



## Entity Manager vs Repository

Entity Manager는 불러와서 그 파일에서 원하는 엔티티의 Repository 생성, 즉 매개변수로 엔티티를 받음

Repository는 정해진 엔티티의 Repository, 매개변수로 엔티티를 받지 않고 사용



## Signup

일단 repository를 사용하여 controllerf를 만들어주려고 한다. 처음 데이터베이스와 서버를 연결짓는 작업이라 많은 시행착오가 예상된다. 

따로 Repository를 사용하지 않고 기본적으로 typeorm에 선언되어있는 repository를 사용해주었다. 

에러가 발생했지만 어떤 에러인지 에러핸들링을 잘못해주어 보이지 않는다.. 

morgan을 사용해보려고한다. 요청이 잘 오는지 확인해보기 위함이다.

확인해보니 url주소를 잘못적었다.. 404에러가 나오는 것을 보고 알게되었다. 

그럼에도 불구하고 에러가 나왔다. 이번에는 Buffer... 라는 에러가 나온 것으로보아  body-parser가 없어서 생긴 문제처럼 보였다.

Body-parser를 넣어도 같은 에러가 발생해서 뭔가했지만 라우터보다 bodyparser가 더 아래에 있어서 발생한 문제였다. 

Body-parser를 위로 올려주니 잘 되지는 않았고 500에러가 정상적으로 발생하였다. No data라는 에러였다(내가 만들어준..). req.body에 아무런 값이 들어오지  않는다..

포스트맨으로 실험하고있지만 왜 안들어오는지.. 이해되지 않는다.

`Bodyparrser.json` 미들웨어가 사용되지 않았다.. urlencoded만 사용했었다...

정상적으로 작동하는 모습을 확인했다. 





### 에러핸들링

항상 서버를 만들때 드는 고민중 하나다.. 에러핸들링을 어떻게 할까?

대부분 비슷한 에러를 가지고 있고 그에 맞는 status 코드들이 있다. 이를 미리 선언해서 돌려쓰는 방법은 없을까? 라는 생각이 들어 에러에 관한 폴더와 파일을 만들어주었다.

잘 되었다! 

이렇게 하니까 항상 상태코드와 에러메시지를 고민할 필요가 없어서 좋았다. 